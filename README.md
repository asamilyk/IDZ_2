# Операционные системы ИДЗ-2 

Самилык Анастасия БПИ229

## Вариант 28
## Работа выполнена на оценку 10.

### Индивидуальное условие: Задача о производстве булавок

В цехе по заточке булавок все необходимые операции осуществляются рабочими на трех производственных участках.

1. На первом участке 1 ≤ K ≤ 3 рабочих получают тупые булавки и в течение некоторого случайного времени каждый из них проверяет ее на предмет кривизны. Если булавка не кривая, то рабочий передает ее на второй участок.

2. На втором участке 1 ≤ L ≤ 5 работников осуществляют заточку. Булавка попадает случайно выбранному из них свободному работнику, который осуществляет заточку и передает заточенную булавку на третий участок.

3. На третьем участке 1 ≤ M ≤ 2 работников осуществляют контроль качества операции.

Требуется создать многопроцессное приложение, моделирующее работу цеха. Каждый работник — это отдельный процесс. При решении использовать парадигму "производитель-потребитель". Следует учесть, что каждая из операций выполняется за случайное время, которое не связано с конкретным рабочим. Передача булавок осуществляется непосредственно от одного рабочего другому. То есть, если все рабочие на определенном участке заняты, то осуществляется ожидание одного из тех, кто освободится.

## Часть на оценку 4-5
Код реализует многопроцессное приложение, моделирующее работу цеха по производству булавок. Используется парадигма "производитель-потребитель". Программа создает несколько процессов для каждого этапа производства: проверка, заточка и контроль качества. Каждый процесс работает с общей памятью и использует семафоры для синхронизации доступа к ней.

**В общем:**
   Множество процессов взаимодействуют с использованием неименованных POSIX семафоров расположенных в разделяемой памяти. Обмен данными также ведется через разделяемую память в стандарте POSIX.
   
### Реализация

- Создание семафора: Используется функция semget для создания неименованного семафора. Если создание не удалось, программа выходит с ошибкой.

- Инициализация семафора: Используется функция semctl для установки начального значения семафора. Если инициализация не удалась, программа выходит с ошибкой.

- Создание разделяемой памяти: Используется функция shmget для создания сегмента разделяемой памяти. Если создание не удалось, программа выходит с ошибкой.

- Прикрепление разделяемой памяти: Используется функция shmat для прикрепления сегмента разделяемой памяти к адресному пространству процесса. Если прикрепление не удалось, программа выходит с ошибкой.

- Создание процессов для каждого этапа производства: Для каждого этапа создается несколько процессов, которые работают с общей памятью. Каждый процесс ожидает доступа к памяти с помощью семафора, затем выполняет свою функцию (проверка, заточка, контроль качества) и освобождает семафор.

- Ожидание завершения процессов: Родительский процесс ожидает завершения всех дочерних процессов с помощью функции wait.

- Отсоединение разделяемой памяти: Используется функция shmdt для отсоединения сегмента разделяемой памяти от адресного пространства процесса. Если отсоединение не удалось, программа выходит с ошибкой.

- Удаление разделяемой памяти и семафора: Используются функции shmctl и semctl для удаления разделяемой памяти и семафора соответственно.

## Часть на оценку 6-7

**В общем:**
    Множество процессов взаимодействуют с использованием именованных POSIX семафоров. Обмен данными ведется через разделяемую память в стандарте POSIX. 

   
### Реализация
- Создание именованного семафора: Используется функция sem_open для создания именованного семафора с правами доступа 0666. Если создание не удалось, программа выходит с ошибкой.
  
- Создание разделяемой памяти: Используется функция shmget для создания сегмента разделяемой памяти. Если создание не удалось, программа выходит с ошибкой.
  
- Прикрепление разделяемой памяти: Используется функция shmat для прикрепления сегмента разделяемой памяти к адресному пространству процесса. Если прикрепление не удалось, программа выходит с ошибкой.
  
- Создание процессов для каждого этапа производства: Для каждого этапа создается несколько процессов, которые работают с общей памятью. Каждый процесс ожидает доступа к памяти с помощью семафора, затем выполняет свою функцию (проверка, заточка, контроль качества) и освобождает семафор.

- Ожидание завершения процессов: Родительский процесс ожидает завершения всех дочерних процессов с помощью функции wait.

- Отсоединение разделяемой памяти: Используется функция shmdt для отсоединения сегмента разделяемой памяти от адресного пространства процесса. Если отсоединение не удалось, программа выходит с ошибкой.

- Удаление разделяемой памяти и семафора: Используются функции shmctl и sem_unlink для удаления разделяемой памяти и именованного семафора соответственно.



## Часть на оценку 8

**В общем:**
   Разработано приложение, состоящее из отдельных программ–
процессов, запускаемых независимо друг от друга. Множество независимых процессов взаимодействуют с использованием семафоров в стандарте UNIX SYSTEM V. Обмен данными ведется через разделяемую память в стандарте UNIX
SYSTEM V.

### Реализация

1. producer.c:
   - Этот процесс отвечает за производство булавок.
   - Используется разделяемая память для обмена данными с другими процессами.

2. check_pin.c:
   - Этот процесс отвечает за проверку качества булавок.
   - Использует разделяемую память для доступа к данным о произведенных булавках.
   - Ожидает появления новой булавки, проверяет ее качество и сообщает о результате проверки.

3. sharpen_pin.c:
   - Этот процесс отвечает за заточку булавок.
   - Использует разделяемую память для доступа к данным о произведенных булавках.
   - Ожидает появления новой булавки, заточивает ее и сообщает о завершении процесса заточки.

4. control_pin.c:
   - Этот процесс отвечает за контроль качества заточенных булавок.
   - Использует разделяемую память для доступа к данным о произведенных и заточенных булавках.
   - Ожидает появления новой заточенной булавки, контролирует ее качество и сообщает о результате контроля.

- Разделяемая память: Используется для обмена данными между процессами о состоянии производства, заточки и контроля качества булавок.
- Семафоры в стиле UNIX System V: Используются для синхронизации доступа к разделяемой памяти, чтобы избежать конфликтов при одновременном доступе нескольких процессов.
- Каждый процесс выполняет свою часть работы независимо от других процессов.
- Семафоры обеспечивают корректный доступ к разделяемой памяти и предотвращают гонки данных.
- Программа успешно моделирует процесс производства булавок, включая проверку качества и контроль качества заточки.


## Часть на оценку 9

**В общем:**
    Множество независимых процессов взаимодействуют с использованием именованных POSIX семафоров. Обмен данными ведется через каналы или очереди сообщений в стандарте POSIX.

### Реализация

## Описание

1. producer.c:
   - Создает именованный семафор для синхронизации доступа к разделяемой памяти.
   - Создает разделяемую память для хранения информации о произведенных булавках.
   - Производит булавки, устанавливая соответствующий флаг в разделяемой памяти.

2. check_pin.c, sharpen_pin.c, control_pin.c:
   - Открывают именованный семафор, созданный процессом producer, для доступа к разделяемой памяти.
   - Открывают разделяемую память, созданную процессом producer, для доступа к информации о произведенных булавках.
   - Ждут появления новой булавки, синхронизируя доступ к разделяемой памяти с помощью семафоров.
   - После получения булавки выполняют свою часть работы (проверка качества, заточка, контроль качества) и обновляют информацию в разделяемой памяти.
   - Имитируют время выполнения каждого процесса.

## Часть на оценку 10

5. **В общем:**
   Множество процессов взаимодействуют с использованием неименованных POSIX семафоров расположенных в разделяемой памяти. Обмен данными также ведется через разделяемую память в стандарте POSIX.
